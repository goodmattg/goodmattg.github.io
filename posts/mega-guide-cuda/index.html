<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Mega-guide to Nvidia CUDA, CUDA Toolkit, CUDA Driver for an Ubuntu 20.04 Nvidia GPU PC Build | Matt's Log</title><meta name=keywords content><meta name=description content="An Ubuntu 20.04 Nvidia GPU CUDA Guide"><meta name=author content="Matt Goodman"><link rel=canonical href=https://goodmattg.github.io/posts/mega-guide-cuda/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://goodmattg.github.io/magnet.ico><link rel=icon type=image/png sizes=16x16 href=https://goodmattg.github.io/magnet-16x16.ico><link rel=icon type=image/png sizes=32x32 href=https://goodmattg.github.io/magnet-32x32.ico><link rel=apple-touch-icon href=https://goodmattg.github.io/magnet-apple-touch-icon.png><link rel=mask-icon href=https://goodmattg.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Mega-guide to Nvidia CUDA, CUDA Toolkit, CUDA Driver for an Ubuntu 20.04 Nvidia GPU PC Build"><meta property="og:description" content="An Ubuntu 20.04 Nvidia GPU CUDA Guide"><meta property="og:type" content="article"><meta property="og:url" content="https://goodmattg.github.io/posts/mega-guide-cuda/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-25T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-25T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mega-guide to Nvidia CUDA, CUDA Toolkit, CUDA Driver for an Ubuntu 20.04 Nvidia GPU PC Build"><meta name=twitter:description content="An Ubuntu 20.04 Nvidia GPU CUDA Guide"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://goodmattg.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Mega-guide to Nvidia CUDA, CUDA Toolkit, CUDA Driver for an Ubuntu 20.04 Nvidia GPU PC Build","item":"https://goodmattg.github.io/posts/mega-guide-cuda/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Mega-guide to Nvidia CUDA, CUDA Toolkit, CUDA Driver for an Ubuntu 20.04 Nvidia GPU PC Build","name":"Mega-guide to Nvidia CUDA, CUDA Toolkit, CUDA Driver for an Ubuntu 20.04 Nvidia GPU PC Build","description":"An Ubuntu 20.04 Nvidia GPU CUDA Guide","keywords":[],"articleBody":"Setting up an Nvidia GPU enabled system is the ante for deep learning research at home. Without a dedicated GPU, users are forced to either use Google Colab, which has great performance for a free service but is a notebook environment, or a cloud ML service that costs money (~$0.9 GPU/hour on AWS). After playing with those options for awhile, I decided to build my own system. In doing so, I learned how confusing the process can be, especially if it‚Äôs your first PC build or first build with a dedicated GPU system.\nSo before getting into this a note of praise - you aren‚Äôt dumb if you don‚Äôt fully understand CUDA drivers. I‚Äôm a deep learning practitioner with software experience, and this was painful for me.\nFirst some terminology:\nNvidia X.Y Toolkit: what tutorials mean when they say ‚Äúinstall CUDA X.Y‚Äù. The core versions of CUDA are 10.xx (past) and 11.yy (future) Nvidia Driver: the driver controlling defining GPU‚Äôs interface with your OS / Architecture. nvcc: the CUDA compiler driver Nvidia Software Ecosystem at-a-glance.\nToolkit documentation:\nRelease Notes :: CUDA Toolkit Documentation\nAlso useful is the driver documentation. You can find it for your specific driver version at:\nNVIDIA Accelerated Linux Graphics Driver README and Installation Guide\nThe Decision: picking your CUDA installation If you read the release notes above, you‚Äôll observe multiple installation methods for the CUDA driver / toolkit pair on linux. It can be deeply confusing. Do I go with the runfile or Debian installer? Should I just go with the newest versions of the CUDA toolkit and CUDA driver?\nNvidia makes it clear that there is no correct answer here. While there are some constraints (described below), just do whatever is right for your system.\nCUDA Compatibility Not every version of CUDA driver supports every version of the CUDA Toolkit. Before making a choice, refer to CUDA compatibility matrix, copied here for reference.\nNVIDIA Driver Documentation\nBut wait! This is not the actual table you should refer to - this table just says that for CUDA Toolkit 11.x minor version compatibility (i.e. to even be able to support minor version ‚Äúx‚Äù), you need at least driver ‚â•450.80.02. The actual table we will refer to is below.\nThis is the reference table we care about - it shows the minimum driver required for Linux 64 bit x86 architecture to support a given CUDA Toolkit version. Let‚Äôs say we decide on 11.2.0 GA for the global installation of CUDA Toolkit on our system. We will need at least CUDA driver 460.27.03 on our system. That‚Äôs it, we‚Äôve solved it ü§ù. We‚Äôre free to use a higher version of the CUDA driver, since CUDA drivers are always designed to be backwards compatible, but sticking with a lower (stable) version of driver is fine too.\nSpecial Case: Forward Compatibility Let‚Äôs quickly discuss a special use-case. The vast majority of users will go with a stable pair of CUDA toolkit and CUDA driver, but what about the case where we‚Äôre fixed to an old driver but want to use a newer version of CUDA.\nAs an example, let‚Äôs say we are fixed to CUDA 418.40.04, but need our system to use CUDA 11.2. The compatibility table says we are out of luck, since the minimum required version is 460.27.03 üò©. Forward compatibility packages to the rescue! Referring to the table below, we see forward compability for the 418.40.04 driver is available for CUDA 10.2-11.6 üéâ.\nAll we have to do is install the forward compatiblity package onto our system. On Ubuntu, prefer installing the compatibility package from network repositories. In highly specific use cases, can install the compatibility package manually from a runfile (.run) - but for most users just use apt-get to install.\n1 sudo apt-get install -y cuda-compat-11-2 The package will install to /usr/local/cuda/compat . Now include the installed CUDA compability files. This code below also runs the CUDA Device Query utility which ‚Äúenumerates the properties of the CUDA devices present in the system‚Äù.****\n1 LD_LIBRARY_PATH=/usr/local/cuda/compat:$LD_LIBRARY_PATH samples/bin/x86_64/linux/release/deviceQuery The Installation Quoting from the Nvidia docs:\nWhen installing CUDA on Ubuntu, you can choose between the Runfile Installer and the Debian Installer. The Runfile Installer is only available as a Local Installer. The Debian Installer is available as both a Local Installer and a Network Installer. The Network Installer allows you to download only the files you need. The Local Installer is a stand-alone installer with a large initial download. In the case of the Debian installers, the instructions for the Local and Network variants are the same.\nAs a heuristic, if you don‚Äôt know why you would choose one installation method over the other, choose the Debian Installer!\nI‚Äôm not going to copy steps from the docs, but to summarize:\nGo through pre-installation actions If going through a ‚Äúlocal‚Äù installation (.deb or .runfile install), instead of network installation (.deb install only), download the installer to your system from the downloads page for the specific CUDA toolkit you want to install Go through installation action Go through post-installation actions Hard Reset: clearing your system of installed CUDA packages ‚ÄúRemoving CUDA‚Äù is a popular topic online. Now that we understand CUDA is actually a collection of packages (Toolkit, Driver, forward-compat, etc.) we have a better idea of what it takes to uninstall CUDA. First, from the Nvidia Docs we can uninstall a CUDA deb installation on Ubuntu using:\n1 sudo apt-get --purge remove cuda* Remember that using deb installs files to /usr/local, so after this command ls /usr/local/ | grep cuda should show no matched files.\nIf we installed using a runfile instead of the deb installer, we need to uninstall the Driver and Toolkit with separate commands:\n1 2 sudo /usr/local/cuda-X.Y/bin/cuda-uninstaller # Uninstall the Toolkit sudo /usr/bin/nvidia-uninstall # Uninstall the Driver Anaconda: the easiest way to manage CUDA versions across projects The easiest way to manage CUDA for different DL projects is manage your environments with Anaconda.\nSome highlights:\nAnaconda can manage multiple CUDA toolkit versions separately from your system‚Äôs base CUDA toolkit version Anaconda takes care of the overhead of installation and un-installation. Uninstall is as easy as conda remove cuda Attempt #1 I had almost no idea what I was doing for this attempt. My only requirement was CUDA 11.7 because I wanted to run Jax from the base CUDA system install and Jax requires 11.7. Given this tutorial, I now know this is not smart. You can install a system-wide version of Toolkit + Driver that is stable to the system hardware (i.e. support suspend-to-RAM) and use conda to manage a higher CUDA version that supports Jax. Installed CUDA driver 515 and CUDA toolkit 11.7 via the Runfile installation method. deviceQuery sample returns expected output and nvidia-smi command also shows expected output. However, I consider this installation attempt a failure. Most important feature for my system is suspend-to-RAM - i.e. the ability to take GPU state at a given time, move it to RAM, and put the system into ‚Äúsuspend‚Äù mode without fully turning off the power. This is the most important feature to modern computer usage - i.e. shutting your laptop lid, opening back up and having all the applications you had open‚Ä¶ still open. Having to do a full power cycle after every computer use significantly hampers usability ü§¶üèº‚Äç‚ôÇÔ∏è. I‚Äôll have to purge everything and try again.\nAttempt #2 (ongoing) Pre-notes: I‚Äôm going to try purging all CUDA from the entire system first. I‚Äôve set in the BIOS that the system uses integrated graphics on the mobo, not the GPU, for graphics, so the system will boot fine without the GPU drivers installed. I have a feeling using the newest Nvidia driver (515) is the problem - going to try reverting to 470 since it comes with the Debian installer and is the base version installed on Ubuntu by default. I‚Äôm also hoping using the Debian installer fixes the ‚Äúsuspend-to-RAM‚Äù issue. If you read the release notes for the drivers (470 vs. 515) they handle power management differently ü§î. I‚Äôm sure 515 has more features + efficiency, but I want things to work.\nSummary Installing CUDA on your system is non-trivial. In general, the Nvidia docs are thorough and do contain all of the information you might need, but feel inscrutable to a first-time user. It would probably be helpful for Nvidia to put together more quick installation guides for common configurations. This guide is by no means complete (or even correct)! If I‚Äôm missing anything, please let me know.\n","wordCount":"1415","inLanguage":"en","datePublished":"2022-06-25T00:00:00Z","dateModified":"2022-06-25T00:00:00Z","author":{"@type":"Person","name":"Matt Goodman"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://goodmattg.github.io/posts/mega-guide-cuda/"},"publisher":{"@type":"Organization","name":"Matt's Log","logo":{"@type":"ImageObject","url":"https://goodmattg.github.io/magnet.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://goodmattg.github.io accesskey=h title="Matt's Log (Alt + H)">Matt's Log</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://goodmattg.github.io/posts title=Posts><span>Posts</span></a></li><li><a href=https://goodmattg.github.io/about title=About><span>About</span></a></li><li><a href=https://goodmattg.github.io/bookshelf title=Bookshelf><span>Bookshelf</span></a></li><li><a href=https://goodmattg.github.io/quotes title=Quotes><span>Quotes</span></a></li><li><a href=https://goodmattg.github.io/contact title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Mega-guide to Nvidia CUDA, CUDA Toolkit, CUDA Driver for an Ubuntu 20.04 Nvidia GPU PC Build</h1><div class=post-description>An Ubuntu 20.04 Nvidia GPU CUDA Guide</div><div class=post-meta><span title='2022-06-25 00:00:00 +0000 UTC'>June 25, 2022</span>&nbsp;¬∑&nbsp;Matt Goodman</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#the-decision-picking-your-cuda-installation aria-label="The Decision: picking your CUDA installation">The Decision: picking your CUDA installation</a><ul><ul><li><a href=#cuda-compatibility aria-label="CUDA Compatibility">CUDA Compatibility</a></li></ul><li><a href=#special-case-forward-compatibility aria-label="Special Case: Forward Compatibility">Special Case: Forward Compatibility</a></li><li><a href=#the-installation aria-label="The Installation">The Installation</a></li></ul></li><li><a href=#hard-reset-clearing-your-system-of-installed-cuda-packages aria-label="Hard Reset: clearing your system of installed CUDA packages">Hard Reset: clearing your system of installed CUDA packages</a></li><li><a href=#anaconda-the-easiest-way-to-manage-cuda-versions-across-projects aria-label="Anaconda: the easiest way to manage CUDA versions across projects">Anaconda: the easiest way to manage CUDA versions across projects</a></li><li><a href=#attempt-1 aria-label="Attempt #1">Attempt #1</a></li><li><a href=#attempt-2-ongoing aria-label="Attempt #2 (ongoing)">Attempt #2 (ongoing)</a></li><li><a href=#summary aria-label=Summary>Summary</a></li></ul></div></details></div><div class=post-content><p>Setting up an Nvidia GPU enabled system is the ante for deep learning research at home. Without a dedicated GPU, users are forced to either use Google Colab, which has great performance for a free service but is a notebook environment, or a cloud ML service that costs money (~$0.9 GPU/hour on AWS). After playing with those options for awhile, I decided to build my own system. In doing so, I learned how confusing the process can be, especially if it‚Äôs your first PC build or first build with a dedicated GPU system.</p><p>So before getting into this a note of praise - you aren‚Äôt dumb if you don‚Äôt fully understand CUDA drivers. I‚Äôm a deep learning practitioner with software experience, and this was painful for me.</p><p>First some terminology:</p><ul><li><strong>Nvidia X.Y Toolkit</strong>: what tutorials mean when they say ‚Äúinstall CUDA X.Y‚Äù. The core versions of CUDA are 10.xx (past) and 11.yy (future)</li><li><strong>Nvidia Driver</strong>: the driver controlling defining GPU‚Äôs interface with your OS / Architecture.</li><li><code>nvcc</code>: the CUDA compiler driver</li></ul><p><img loading=lazy src=/assets/posts/Mega-guide-CUDA/CUDA.png alt="Nvidia Software Ecosystem at-a-glance. "></p><p>Nvidia Software Ecosystem at-a-glance.</p><p>Toolkit documentation:</p><p><a href=https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html>Release Notes :: CUDA Toolkit Documentation</a></p><p>Also useful is the driver documentation. You can find it for your specific driver version at:</p><p><a href=https://download.nvidia.com/XFree86/Linux-x86_64/515.43.04/README/>NVIDIA Accelerated Linux Graphics Driver README and Installation Guide</a></p><h1 id=the-decision-picking-your-cuda-installation>The Decision: picking your CUDA installation<a hidden class=anchor aria-hidden=true href=#the-decision-picking-your-cuda-installation>#</a></h1><p>If you read the release notes above, you‚Äôll observe multiple installation methods for the CUDA driver / toolkit pair on linux. It can be deeply confusing. Do I go with the runfile or Debian installer? Should I just go with the newest versions of the CUDA toolkit and CUDA driver?</p><p>Nvidia makes it clear that there is no correct answer here. While there are some constraints (described below), just do whatever is right for your system.</p><h3 id=cuda-compatibility>CUDA Compatibility<a hidden class=anchor aria-hidden=true href=#cuda-compatibility>#</a></h3><p>Not every version of CUDA driver supports every version of the CUDA Toolkit. Before making a choice, refer to CUDA compatibility matrix, copied here for reference.</p><p><img loading=lazy src=/assets/posts/Mega-guide-CUDA/CUDA_MINOR_VERSION_COMPAT.png alt=CUDA_MINOR_VERSION_COMPAT.png></p><p><a href=https://docs.nvidia.com/deploy/cuda-compatibility/index.html>NVIDIA Driver Documentation</a></p><p><strong>But wait!</strong> This is not the actual table you should refer to - this table just says that for CUDA Toolkit 11.x minor version compatibility (i.e. to even be able to support minor version ‚Äúx‚Äù), you need at least driver ‚â•450.80.02. The actual table we will refer to is below.</p><p><img loading=lazy src=/assets/posts/Mega-guide-CUDA/CUDA_VERSION_COMPAT.png alt=CUDA_VERSION_COMPAT.png></p><p>This is the reference table we care about - it shows the minimum driver required for Linux 64 bit x86 architecture to support a given CUDA Toolkit version. Let‚Äôs say we decide on 11.2.0 GA for the global installation of CUDA Toolkit on our system. We will need at least CUDA driver 460.27.03 on our system. That‚Äôs it, we‚Äôve solved it ü§ù. We‚Äôre free to use a higher version of the CUDA driver, since CUDA drivers are always designed to be backwards compatible, but sticking with a lower (stable) version of driver is fine too.</p><h2 id=special-case-forward-compatibility>Special Case: Forward Compatibility<a hidden class=anchor aria-hidden=true href=#special-case-forward-compatibility>#</a></h2><p>Let‚Äôs quickly discuss a special use-case. The vast majority of users will go with a stable pair of CUDA toolkit and CUDA driver, but what about the case where we‚Äôre fixed to an old driver but want to use a newer version of CUDA.</p><p>As an example, let‚Äôs say we are fixed to CUDA 418.40.04, but need our system to use CUDA 11.2. The compatibility table says we are out of luck, since the minimum required version is 460.27.03 üò©. Forward compatibility packages to the rescue! Referring to the table below, we see forward compability for the 418.40.04 driver is available for CUDA 10.2-11.6 üéâ.</p><p><img loading=lazy src=/assets/posts/Mega-guide-CUDA/FORWARD_COMPATIBILITY.png alt="FORWARD COMPATIBILITY.png"></p><p>All we have to do is install the forward compatiblity package onto our system. On Ubuntu, prefer installing the compatibility package from network repositories. In highly specific use cases, can install the compatibility package manually from a runfile (.run) - but for most users just use <code>apt-get</code> to install.</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#454545">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install -y cuda-compat-11-2
</span></span></code></pre></td></tr></table></div></div><p>The package will install to <code>/usr/local/cuda/compat</code> . Now include the installed CUDA compability files. This code below also runs the CUDA Device Query utility which ‚Äúenumerates the properties of the CUDA devices present in the system‚Äù.****</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#454545">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#0087ff>LD_LIBRARY_PATH</span>=/usr/local/cuda/compat:<span style=color:#0087ff>$LD_LIBRARY_PATH</span> samples/bin/x86_64/linux/release/deviceQuery
</span></span></code></pre></td></tr></table></div></div><h2 id=the-installation>The Installation<a hidden class=anchor aria-hidden=true href=#the-installation>#</a></h2><p>Quoting from the Nvidia <a href=https://docs.nvidia.com/cuda/cuda-quick-start-guide/index.html#ubuntu-x86_64>docs</a>:</p><blockquote><p>When installing CUDA on Ubuntu, you can choose between the Runfile Installer and the Debian Installer. The Runfile Installer is only available as a Local Installer. The Debian Installer is available as both a Local Installer and a Network Installer. The Network Installer allows you to download only the files you need. The Local Installer is a stand-alone installer with a large initial download. In the case of the Debian installers, the instructions for the Local and Network variants are the same.</p></blockquote><p>As a heuristic, if you don‚Äôt know why you would choose one installation method over the other, <strong>choose the Debian Installer!</strong></p><p>I‚Äôm not going to copy steps from the docs, but to summarize:</p><ol><li>Go through <a href=https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#pre-installation-actions>pre-installation</a> actions<ol><li>If going through a ‚Äúlocal‚Äù installation (.deb or .runfile install), instead of network installation (.deb install only), download the installer to your system from the <a href=https://developer.nvidia.com/cuda-toolkit-archive>downloads</a> page for the specific CUDA toolkit you want to install</li></ol></li><li>Go through <a href=https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#ubuntu-installation>installation</a> action</li><li>Go through <a href=https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#post-installation-actions>post-installation</a> actions</li></ol><h1 id=hard-reset-clearing-your-system-of-installed-cuda-packages>Hard Reset: clearing your system of installed CUDA packages<a hidden class=anchor aria-hidden=true href=#hard-reset-clearing-your-system-of-installed-cuda-packages>#</a></h1><p>‚ÄúRemoving CUDA‚Äù is a popular topic online. Now that we understand CUDA is actually a collection of packages (Toolkit, Driver, forward-compat, etc.) we have a better idea of what it takes to uninstall CUDA. First, from the Nvidia Docs we can uninstall a CUDA <code>deb</code> installation on Ubuntu using:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#454545">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get --purge remove cuda*
</span></span></code></pre></td></tr></table></div></div><p>Remember that using <code>deb</code> installs files to <code>/usr/local</code>, so after this command <code>ls /usr/local/ | grep cuda</code> should show no matched files.</p><p>If we installed using a runfile instead of the deb installer, we need to uninstall the Driver and Toolkit with separate commands:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#454545">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo /usr/local/cuda-X.Y/bin/cuda-uninstaller <span style=color:#4e4e4e># Uninstall the Toolkit</span>
</span></span><span style=display:flex><span>sudo /usr/bin/nvidia-uninstall <span style=color:#4e4e4e># Uninstall the Driver</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=anaconda-the-easiest-way-to-manage-cuda-versions-across-projects>Anaconda: the easiest way to manage CUDA versions across projects<a hidden class=anchor aria-hidden=true href=#anaconda-the-easiest-way-to-manage-cuda-versions-across-projects>#</a></h1><p>The easiest way to manage CUDA for different DL projects is manage your environments with Anaconda.</p><p>Some highlights:</p><ul><li>Anaconda can manage multiple CUDA toolkit versions separately from your system‚Äôs base CUDA toolkit version</li><li>Anaconda takes care of the overhead of installation and un-installation.</li><li>Uninstall is as easy as <code>conda remove cuda</code></li></ul><h1 id=attempt-1>Attempt #1<a hidden class=anchor aria-hidden=true href=#attempt-1>#</a></h1><p>I had almost no idea what I was doing for this attempt. My only requirement was CUDA 11.7 because I wanted to run Jax from the base CUDA system install and Jax requires 11.7. Given this tutorial, I now know this is not smart. You can install a system-wide version of Toolkit + Driver that is stable to the system hardware (i.e. support suspend-to-RAM) and use conda to manage a higher CUDA version that supports Jax. Installed CUDA driver 515 and CUDA toolkit 11.7 via the Runfile installation method. <code>deviceQuery</code> sample returns expected output and <code>nvidia-smi</code> command also shows expected output. However, I consider this installation attempt a failure. Most important feature for my system is <code>suspend-to-RAM</code> - i.e. the ability to take GPU state at a given time, move it to RAM, and put the system into ‚Äúsuspend‚Äù mode without fully turning off the power. This is the most important feature to modern computer usage - i.e. shutting your laptop lid, opening back up and having all the applications you had open&mldr; still open. Having to do a full power cycle after every computer use significantly hampers usability ü§¶üèº‚Äç‚ôÇÔ∏è. I‚Äôll have to purge everything and try again.</p><h1 id=attempt-2-ongoing>Attempt #2 (ongoing)<a hidden class=anchor aria-hidden=true href=#attempt-2-ongoing>#</a></h1><p>Pre-notes: I‚Äôm going to try purging all CUDA from the entire system first. I‚Äôve set in the BIOS that the system uses integrated graphics on the mobo, not the GPU, for graphics, so the system will boot fine without the GPU drivers installed. I have a feeling using the newest Nvidia driver (515) is the problem - going to try reverting to 470 since it comes with the Debian installer and is the base version installed on Ubuntu by default. I‚Äôm also hoping using the Debian installer fixes the ‚Äúsuspend-to-RAM‚Äù issue. If you read the release notes for the drivers (470 vs. 515) they handle power management differently ü§î. I‚Äôm sure 515 has more features + efficiency, but I want things to work.</p><h1 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h1><p>Installing CUDA on your system is non-trivial. In general, the Nvidia docs are thorough and <strong>do</strong> contain all of the information you might need, but feel inscrutable to a first-time user. It would probably be helpful for Nvidia to put together more quick installation guides for common configurations. This guide is by no means complete (or even correct)! If I‚Äôm missing anything, please let me know.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://goodmattg.github.io>Matt's Log</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>